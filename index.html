<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GalaxyPengin</title>
<link rel="icon" href="images/important/CirclePFP" type="image/png" />
<link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="gray-text">
  <br>
  Unique visitors: <span id="visitor-count">â€¦</span>
</div>
<img src="images/important/randompenguin.png" class="toppenguin" />

<div class="text-container">
  <div class="welcome-text">
    <u>Welcome to <span class="site-name">galaxypengin.com</span>!</u>
  </div>
  <br>
  <div class="gray-text">Last Edited: 5/19/2025, 00:58</div>
  <div class="highlight">ðŸš§<u>Under construction</u>ðŸš§</div>
  <div><i>Check back soon!</i></div>
</div>
<div class="embed-container">
  <div class="currently-listening-to-txt">Currently Listening To:</div>
  <div class="embed-content" id="embedContent">Loading Embed...</div>
</div>

<script>
async function fetchVisitorCount() {
  try {
    const response = await fetch('https://gpwebflask.onrender.com/api/visitors');
    if (!response.ok) throw new Error('Network response was not ok');
    const data = await response.json();
    console.log("Visitor count fetched:", data.count);
    document.getElementById('visitor-count').textContent = data.count;
  } catch (err) {
    document.getElementById('visitor-count').textContent = 'Error loading count';
    console.error(err);
  }
}
fetchVisitorCount();
setInterval(fetchVisitorCount, 60000);
(() => {
  const embedContent = document.getElementById('embedContent');
  const vinyl = `
    <img src="images/important/GPVinyl.png" 
      alt="Vinyl image" 
      width="150" 
      style="margin-top: 9px; animation: rotate 4s linear infinite; display: inline-block;">`;

  let currentTrackId = null;

  async function fetchNowPlaying() {
    try {
      const response = await fetch('https://gpwebflask.onrender.com/now-playing');
      if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`HTTP ${response.status} - ${errorText}`);
      }
      const data = await response.json();
  
      if (data?.is_playing && data.item?.name && data.item.artists?.length) {
        if (data.item.id !== currentTrackId) {
          currentTrackId = data.item.id;
          embedContent.innerHTML = `
            <iframe src="https://open.spotify.com/embed/track/${currentTrackId}?theme=0"
                    width="100%" height="160" frameborder="0"
                    allowtransparency="true" allow="encrypted-media"></iframe>`;
        }
      } else {
        currentTrackId = null;
        if (!embedContent.innerHTML.includes('GPVinyl.png')) {
          embedContent.innerHTML = vinyl;
        }
      }
    } catch (err) {
      if (!embedContent.innerHTML.includes('GPVinyl.png')) {
        embedContent.innerHTML = vinyl;
      }
      console.error('Fetch error:', err);
    }
  }

  fetchNowPlaying();
  setInterval(fetchNowPlaying, 1000);
})();
</script>

</body>
</html>
